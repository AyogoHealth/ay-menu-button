{"version":3,"file":"index.js","sources":["../src/manager.ts","../src/button.ts","../src/index.ts"],"sourcesContent":["/*! Copyright 2016 Ayogo Health Inc. */\r\n\r\nexport class MenuManager {\r\n    private static curMenu : HTMLMenuElement | null             = null;\r\n    private static curButton : HTMLButtonElement | null         = null;\r\n    private static isOpen : boolean                             = false;\r\n    private static focusCount : number | null                   = null;\r\n    private static transitionEndHandler : (() => void) | null   = null;\r\n    private static scrollJack : (() => void) | null             = null;\r\n\r\n\r\n    static get open() {\r\n        return this.isOpen;\r\n    }\r\n\r\n    static openMenu(btn : HTMLButtonElement, focus : boolean = false) {\r\n        if (this.transitionEndHandler !== null) {\r\n            this.transitionEndHandler();\r\n        }\r\n\r\n        let mnuID = btn.getAttribute('menu');\r\n        if (!mnuID) {\r\n            return;\r\n        }\r\n\r\n        let mnu = btn.ownerDocument.getElementById(mnuID);\r\n        if (!mnu) {\r\n            return;\r\n        }\r\n\r\n        this.curButton = btn;\r\n        this.curMenu = mnu as HTMLMenuElement;\r\n        this.isOpen = true;\r\n\r\n        this.curButton.setAttribute('aria-expanded', 'true');\r\n        this.curButton.ownerDocument.documentElement.addEventListener('click', this.clickListener);\r\n        this.curButton.addEventListener('blur', this.handleBlur);\r\n\r\n        // Before we open the menu, we need to move it in the DOM so that is\r\n        // is directly after the button element for tab ordering\r\n        this.curButton.parentNode!.insertBefore(this.curMenu, this.curButton.nextSibling);\r\n\r\n        let offset = this.getScrollOffset();\r\n\r\n        this.addMenuStyle();\r\n\r\n        this.scrollJack = this.blockScrolling(offset);\r\n\r\n        if (focus) {\r\n            this.focusMenu();\r\n        }\r\n\r\n        this.curMenu.addEventListener('keydown', this.menuKeypressListener);\r\n        this.curMenu.addEventListener('focusout', this.handleBlur);\r\n        this.curMenu.addEventListener('click', this.menuClickListener);\r\n    }\r\n\r\n\r\n    static closeMenu() {\r\n        if (!this.isOpen || !this.curButton || !this.curMenu) {\r\n            return;\r\n        }\r\n\r\n        this.curButton.ownerDocument.documentElement.removeEventListener('click', this.clickListener);\r\n        this.curButton.removeEventListener('blur', this.handleBlur);\r\n        this.curButton.setAttribute('aria-expanded', 'false');\r\n        this.curButton.setAttribute('data-dir', 'down');\r\n\r\n        this.curMenu.removeEventListener('keydown', this.menuKeypressListener);\r\n        this.curMenu.removeEventListener('focusout', this.handleBlur);\r\n        this.curMenu.removeEventListener('click', this.menuClickListener);\r\n\r\n        if (this.scrollJack) {\r\n            this.scrollJack();\r\n        }\r\n\r\n        let oldMenu = this.curMenu;\r\n        this.transitionEndHandler = () => {\r\n            oldMenu.removeAttribute('style');\r\n            oldMenu.removeEventListener('transitionend', this.transitionEndHandler!);\r\n            oldMenu.removeEventListener('webkittransitionend', this.transitionEndHandler!);\r\n            this.transitionEndHandler = null;\r\n        };\r\n\r\n        if ('transitionDuration' in oldMenu.style) {\r\n            oldMenu.style.transitionDuration = '192ms';\r\n        } else {\r\n            oldMenu.style.webkitTransitionDuration = '192ms';\r\n        }\r\n\r\n        if ('transform' in oldMenu.style) {\r\n            oldMenu.style.transform = 'scaleY(0)';\r\n        } else {\r\n            oldMenu.style.webkitTransform = 'scaleY(0)';\r\n        }\r\n\r\n        oldMenu.addEventListener('transitionend', this.transitionEndHandler!);\r\n        oldMenu.addEventListener('webkittransitionend', this.transitionEndHandler!);\r\n\r\n        this.isOpen = false;\r\n        this.curButton = null;\r\n        this.curMenu = null;\r\n        this.focusCount = null;\r\n    }\r\n\r\n\r\n    static toggleMenu(btn : HTMLButtonElement) {\r\n        let openMnu = this.curMenu;\r\n\r\n        if (this.isOpen) {\r\n            this.closeMenu();\r\n        }\r\n\r\n        if (!openMnu || openMnu.getAttribute('id') !== btn.getAttribute('menu')) {\r\n            this.openMenu(btn);\r\n        }\r\n    }\r\n\r\n\r\n    static focusMenu() {\r\n        if (!this.curMenu) {\r\n            return;\r\n        }\r\n\r\n        if (this.focusCount === null) {\r\n            this.focusCount = 0;\r\n        }\r\n\r\n        let length = this.curMenu.children.length;\r\n\r\n        if (this.focusCount < 0) {\r\n            this.focusCount += length;\r\n        }\r\n\r\n        let mi = this.curMenu.children[this.focusCount % length] as HTMLElement;\r\n        mi.focus();\r\n    }\r\n\r\n\r\n    private static clickMenuItem() {\r\n        if (!this.curMenu) {\r\n            return;\r\n        }\r\n\r\n        let length = this.curMenu.children.length;\r\n        let mi = this.curMenu.children[(this.focusCount || 0) % length] as HTMLElement;\r\n\r\n        if (!mi.hasAttribute('disabled')) {\r\n            mi.click();\r\n        }\r\n    }\r\n\r\n\r\n    private static addMenuStyle() {\r\n        if (!this.curMenu || !this.curButton) {\r\n            return;\r\n        }\r\n\r\n        let menu = this.curMenu!;\r\n        let btn = this.curButton!;\r\n\r\n        // Add the menu to the DOM for measuring\r\n        menu.style.display = 'block';\r\n        menu.style.position = 'fixed';\r\n        menu.setAttribute('role', 'menu');\r\n        menu.setAttribute('data-owner', 'button');\r\n\r\n        // Try to unset the type so Firefox can make it visible :'(\r\n        menu.setAttribute('type', '');\r\n\r\n        // Ensure the children are focusable\r\n        for (let i = 0; i < menu.children.length; i++) {\r\n            menu.children[i].setAttribute('tabindex', '-1');\r\n            menu.children[i].setAttribute('role', 'menuitem');\r\n\r\n            menu.children[i].setAttribute('aria-disabled', menu.children[i].hasAttribute('disabled').toString());\r\n        }\r\n\r\n        requestAnimationFrame(() => {\r\n            let btnSize = btn.getBoundingClientRect();\r\n            let menuSize = menu.getBoundingClientRect();\r\n            let wndHeight = window.innerHeight;\r\n\r\n            if (btnSize.bottom + menuSize.height > wndHeight) {\r\n                menu.style.top = (btnSize.top - menuSize.height) + 'px';\r\n                btn.setAttribute('data-dir', 'up');\r\n                menu.setAttribute('data-dir', 'up');\r\n            } else {\r\n                menu.style.top = btnSize.bottom + 'px';\r\n                btn.setAttribute('data-dir', 'down');\r\n                menu.setAttribute('data-dir', 'down');\r\n            }\r\n\r\n            if (menuSize.width > btnSize.right) {\r\n                menu.style.left = btnSize.left + 'px';\r\n            } else {\r\n                menu.style.left = (btnSize.right - menuSize.width) + 'px';\r\n            }\r\n\r\n            if ('transform' in menu.style) {\r\n                menu.style.transform = 'scaleY(0)';\r\n\r\n                requestAnimationFrame(() => {\r\n                    menu.style.transform = 'scaleY(1)';\r\n                });\r\n            } else {\r\n                menu.style.webkitTransform = 'scaleY(0)';\r\n\r\n                requestAnimationFrame(() => {\r\n                    menu.style.webkitTransform = 'scaleY(1)';\r\n                });\r\n            }\r\n        });\r\n    }\r\n\r\n\r\n    private static clickListener(e : MouseEvent) {\r\n        if (!MenuManager.curButton || !MenuManager.curMenu) {\r\n            return;\r\n        }\r\n\r\n        if (MenuManager.curMenu.contains(e.target as Node)) {\r\n            return;\r\n        }\r\n\r\n        if (MenuManager.curButton.contains(e.target as Node)) {\r\n            return;\r\n        }\r\n\r\n        MenuManager.curButton.focus();\r\n        MenuManager.closeMenu();\r\n    }\r\n\r\n\r\n    private static menuClickListener(e : MouseEvent) {\r\n        if (!MenuManager.curButton || !MenuManager.curMenu) {\r\n            return;\r\n        }\r\n\r\n        let mi = e.target as HTMLElement;\r\n\r\n        if (!MenuManager.curMenu.contains(mi)) {\r\n            return;\r\n        }\r\n\r\n        if (mi.hasAttribute('disabled')) {\r\n            return;\r\n        }\r\n\r\n        MenuManager.curButton.focus();\r\n        MenuManager.closeMenu();\r\n    }\r\n\r\n\r\n    private static handleBlur(e : FocusEvent) {\r\n        if (!MenuManager.curButton) {\r\n            return;\r\n        }\r\n\r\n        // Element that focus is moving to\r\n        let activeEl = e.relatedTarget as HTMLElement | null;\r\n\r\n        if (!activeEl) {\r\n            return;\r\n        }\r\n\r\n        if (MenuManager.curButton === activeEl) {\r\n            return;\r\n        }\r\n\r\n        if (MenuManager.curMenu && MenuManager.curMenu.contains(activeEl)) {\r\n            return;\r\n        }\r\n\r\n        // Wait until after focus has moved before closing the menu\r\n        setTimeout(() => {\r\n            if (MenuManager.isOpen) {\r\n                MenuManager.closeMenu();\r\n            }\r\n        }, 0);\r\n    }\r\n\r\n\r\n    private static menuKeypressListener(e : KeyboardEvent) {\r\n        if (!MenuManager.isOpen) {\r\n            return;\r\n        }\r\n\r\n        // Escape\r\n        if (e.keyCode === 27) {\r\n            if (MenuManager.curButton) {\r\n                MenuManager.curButton.focus();\r\n            }\r\n\r\n            MenuManager.closeMenu();\r\n        }\r\n\r\n        // Up Arrow\r\n        if (e.keyCode === 38) {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n\r\n            if (MenuManager.focusCount !== null) {\r\n                MenuManager.focusCount--;\r\n            }\r\n            MenuManager.focusMenu();\r\n        }\r\n\r\n        // Down Arrow\r\n        if (e.keyCode === 40) {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n\r\n            if (MenuManager.focusCount !== null) {\r\n                MenuManager.focusCount++;\r\n            }\r\n            MenuManager.focusMenu();\r\n        }\r\n\r\n\r\n        // Enter and Spacebar\r\n        if (e.keyCode === 32 || e.keyCode === 13) {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n\r\n            MenuManager.clickMenuItem();\r\n        }\r\n    }\r\n\r\n\r\n    private static getScrollOffset() {\r\n        let doc = this.curButton!.ownerDocument;\r\n\r\n        if (doc.body.style.top) {\r\n            return Math.abs(parseInt(doc.body.style.top, 10));\r\n        }\r\n\r\n        if (doc.scrollingElement) {\r\n            return doc.scrollingElement.scrollTop;\r\n        } else {\r\n            return doc.documentElement.scrollTop + doc.body.scrollTop;\r\n        }\r\n    }\r\n\r\n\r\n    private static blockScrolling(offset : number) {\r\n        let doc = this.curButton!.ownerDocument;\r\n        let htmlNode = doc.documentElement;\r\n        let clientWidth = doc.body.clientWidth;\r\n\r\n        if (doc.body.scrollHeight > htmlNode.clientHeight) {\r\n            doc.body.style.position = 'fixed';\r\n            doc.body.style.left = '0';\r\n            doc.body.style.right = '0';\r\n            doc.body.style.top = -offset + 'px';\r\n\r\n            htmlNode.style.overflowY = 'scroll';\r\n        }\r\n\r\n        if (doc.body.clientWidth < clientWidth) {\r\n            doc.body.style.overflow = 'hidden';\r\n        }\r\n\r\n        return function() {\r\n            doc.body.style.removeProperty('position');\r\n            doc.body.style.removeProperty('left');\r\n            doc.body.style.removeProperty('right');\r\n            doc.body.style.removeProperty('top');\r\n            doc.body.style.removeProperty('overflow');\r\n            htmlNode.style.removeProperty('overflow-y');\r\n\r\n            if (doc.scrollingElement) {\r\n                doc.scrollingElement.scrollTop = offset;\r\n            } else {\r\n                scrollTo(0, offset);\r\n            }\r\n        };\r\n    }\r\n}\r\n","/*! Copyright 2016 Ayogo Health Inc. */\r\n\r\nimport { MenuManager } from './manager';\r\n\r\nexport class MenuButtonBehaviour {\r\n    private el: null | HTMLButtonElement;\r\n\r\n    private clickHandler : null | (() => void);\r\n    private keyHandler : null | ((e : KeyboardEvent) => void);\r\n    private resizeHandler : null | (() => void);\r\n\r\n    constructor(btn : HTMLButtonElement) {\r\n        this.el = btn;\r\n\r\n        this.el.setAttribute('aria-haspopup', 'true');\r\n        this.el.setAttribute('aria-expanded', 'false');\r\n\r\n        this.clickHandler = () => {\r\n            MenuManager.toggleMenu(this.el!);\r\n        };\r\n\r\n        this.keyHandler = (e : KeyboardEvent) => {\r\n            this.buttonKeypressListener(e);\r\n        };\r\n\r\n        this.resizeHandler = () => {\r\n            MenuManager.closeMenu();\r\n        };\r\n\r\n        this.el.addEventListener('click', this.clickHandler!);\r\n        this.el.addEventListener('keydown', this.keyHandler!);\r\n        window.addEventListener('resize', this.resizeHandler!);\r\n    }\r\n\r\n\r\n    // Cleanup function\r\n    destroy() {\r\n        if (this.el) {\r\n            this.el.removeEventListener('click', this.clickHandler!);\r\n            this.el.removeEventListener('keydown', this.keyHandler!);\r\n            window.removeEventListener('resize', this.resizeHandler!);\r\n        }\r\n\r\n        this.clickHandler = null;\r\n        this.keyHandler = null;\r\n        this.resizeHandler = null;\r\n        this.el = null;\r\n    }\r\n\r\n\r\n    private buttonKeypressListener(e : KeyboardEvent) {\r\n        // Escape\r\n        if (MenuManager.open && e.keyCode == 27) {\r\n            MenuManager.closeMenu();\r\n        }\r\n\r\n        // DOWN ARROW\r\n        if (e.keyCode == 40) {\r\n            if (!MenuManager.open) {\r\n                MenuManager.openMenu(this.el!, true);\r\n            } else {\r\n                MenuManager.focusMenu();\r\n            }\r\n        }\r\n    }\r\n}\r\n","/*! Copyright 2016 Ayogo Health Inc. */\r\n\r\n\r\nimport { MenuButtonBehaviour } from './button';\r\n\r\nconst MENU_STYLES = `\r\nmenu[type=\"context\"],\r\nmenu[data-owner=\"button\"] {\r\n    display: none;\r\n    padding: 0;\r\n    margin: 0;\r\n    border: 1px solid;\r\n    will-change: transform;\r\n    transform-origin: top center;\r\n    transition: transform 225ms cubic-bezier(0.4, 0.0, 0.2, 1);\r\n}\r\n\r\nmenu[type=\"context\"][data-dir=\"up\"],\r\nmenu[data-owner=\"button\"][data-dir=\"up\"] {\r\n    transform-origin: bottom center;\r\n}\r\n\r\nmenuitem {\r\n    display: list-item;\r\n    list-style-type: none;\r\n    background: Menu;\r\n    font: menu;\r\n    padding: 0.25em 0.5em;\r\n    cursor: default;\r\n}\r\n\r\nmenuitem::after {\r\n    content: attr(label);\r\n}\r\n\r\nmenuitem[disabled] {\r\n    color: GrayText;\r\n}\r\n\r\nmenuitem:not([disabled]):hover,\r\nmenuitem:not([disabled]):focus {\r\n    background: Highlight;\r\n    color: HighlightText;\r\n}\r\n\r\nbutton[type=\"menu\"]::after,\r\nbutton[data-type=\"menu\"]:after { content: ' â¾'; }\r\n\r\nbutton[type=\"menu\"]:empty::after,\r\nbutton[data-type=\"menu\"]:empty:after { content: 'â¾'; } /* No space character */\r\n\r\nbutton[type=\"menu\"][data-dir=\"up\"]::after,\r\nbutton[data-type=\"menu\"][data-dir=\"up\"]:after { content: ' â´'; }\r\n\r\nbutton[type=\"menu\"][data-dir=\"up\"]:empty::after,\r\nbutton[data-type=\"menu\"][data-dir=\"up\"]:empty:after { content: 'â´'; } /* No space character */\r\n`;\r\n\r\n\r\nconst PREFIX_STYLES = `\r\nmenu[type=\"context\"],\r\nmenu[data-owner=\"button\"] {\r\n    -webkit-transform-origin: top center;\r\n    -webkit-transition: -webkit-transform 225ms cubic-bezier(0.4, 0.0, 0.2, 1);\r\n    transition: -webkit-transform 225ms cubic-bezier(0.4, 0.0, 0.2, 1);\r\n}\r\n\r\nmenu[type=\"context\"][data-dir=\"up\"],\r\nmenu[data-owner=\"button\"][data-dir=\"up\"] {\r\n    -webkit-transform-origin: bottom center;\r\n}\r\n`\r\n\r\n\r\n// Inject default styling\r\n\r\nlet mnuStyle = document.createElement('style');\r\nmnuStyle.appendChild(document.createTextNode(MENU_STYLES));\r\n\r\n// Add old prefixed styles for older iOS and Android devices\r\nif (!('transform' in document.createElement('div').style)) {\r\n    mnuStyle.appendChild(document.createTextNode(PREFIX_STYLES));\r\n}\r\n\r\n\r\nlet insertPoint : HTMLElement | null;\r\nif (insertPoint = document.querySelector('link')) {\r\n    insertPoint.parentNode!.insertBefore(mnuStyle, insertPoint);\r\n} else\r\nif (insertPoint = document.querySelector('style')) {\r\n    insertPoint.parentNode!.insertBefore(mnuStyle, insertPoint);\r\n} else\r\nif (insertPoint = document.querySelector('head')) {\r\n    insertPoint.appendChild(mnuStyle);\r\n} else {\r\n    document.appendChild(mnuStyle);\r\n}\r\n\r\n\r\nlet gcCache : WeakMap<HTMLButtonElement, MenuButtonBehaviour> | null = null;\r\nif ('WeakMap' in window) {\r\n    gcCache = new WeakMap();\r\n}\r\n\r\n\r\nexport default function MenuButton(el : HTMLButtonElement) {\r\n    let behaviour = new MenuButtonBehaviour(el);\r\n\r\n    if (gcCache) {\r\n        gcCache.set(el, behaviour);\r\n    }\r\n\r\n    return behaviour;\r\n}\r\n"],"names":[],"mappings":"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"}