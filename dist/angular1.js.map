{"version":3,"file":"angular1.js","sources":["../src/manager.ts","../src/button.ts","../src/index.ts","../src/angular1.ts"],"sourcesContent":["/*! Copyright 2016 Ayogo Health Inc. */\n\nexport class MenuManager {\n    private static curMenu : HTMLMenuElement | null             = null;\n    private static curButton : HTMLButtonElement | null         = null;\n    private static isOpen : boolean                             = false;\n    private static focusCount : number | null                   = null;\n    private static transitionEndHandler : (() => void) | null   = null;\n    private static scrollJack : (() => void) | null             = null;\n\n\n    static get open() {\n        return this.isOpen;\n    }\n\n    static openMenu(btn : HTMLButtonElement, focus : boolean = false) {\n        if (this.transitionEndHandler !== null) {\n            this.transitionEndHandler();\n        }\n\n        let mnuID = btn.getAttribute('menu');\n        if (!mnuID) {\n            return;\n        }\n\n        let mnu = btn.ownerDocument.getElementById(mnuID);\n        if (!mnu) {\n            return;\n        }\n\n        this.curButton = btn;\n        this.curMenu = mnu as HTMLMenuElement;\n        this.isOpen = true;\n\n        this.curButton.setAttribute('aria-expanded', 'true');\n        this.curButton.ownerDocument.documentElement.addEventListener('click', this.clickListener);\n        this.curButton.addEventListener('blur', this.handleBlur);\n\n        // Before we open the menu, we need to move it in the DOM so that is\n        // is directly after the button element for tab ordering\n        this.curButton.parentNode!.insertBefore(this.curMenu, this.curButton.nextSibling);\n\n        let offset = this.getScrollOffset();\n\n        this.addMenuStyle();\n\n        this.scrollJack = this.blockScrolling(offset);\n\n        if (focus) {\n            this.focusMenu();\n        }\n\n        this.curMenu.addEventListener('keydown', this.menuKeypressListener);\n        this.curMenu.addEventListener('focusout', this.handleBlur);\n        this.curMenu.addEventListener('click', this.menuClickListener);\n    }\n\n\n    static closeMenu() {\n        if (!this.isOpen || !this.curButton || !this.curMenu) {\n            return;\n        }\n\n        this.curButton.ownerDocument.documentElement.removeEventListener('click', this.clickListener);\n        this.curButton.removeEventListener('blur', this.handleBlur);\n        this.curButton.setAttribute('aria-expanded', 'false');\n\n        this.curMenu.removeEventListener('keydown', this.menuKeypressListener);\n        this.curMenu.removeEventListener('focusout', this.handleBlur);\n        this.curMenu.removeEventListener('click', this.menuClickListener);\n\n        if (this.scrollJack) {\n            this.scrollJack();\n        }\n\n        let oldMenu = this.curMenu;\n        this.transitionEndHandler = () => {\n            oldMenu.removeAttribute('style');\n            oldMenu.removeEventListener('transitionend', this.transitionEndHandler!);\n            oldMenu.removeEventListener('webkittransitionend', this.transitionEndHandler!);\n            this.transitionEndHandler = null;\n        };\n\n        if ('transitionDuration' in oldMenu.style) {\n            oldMenu.style.transitionDuration = '192ms';\n        } else {\n            oldMenu.style.webkitTransitionDuration = '192ms';\n        }\n\n        if ('transform' in oldMenu.style) {\n            oldMenu.style.transform = 'scaleY(0)';\n        } else {\n            oldMenu.style.webkitTransform = 'scaleY(0)';\n        }\n\n        oldMenu.addEventListener('transitionend', this.transitionEndHandler!);\n        oldMenu.addEventListener('webkittransitionend', this.transitionEndHandler!);\n\n        this.isOpen = false;\n        this.curButton = null;\n        this.curMenu = null;\n        this.focusCount = null;\n    }\n\n\n    static toggleMenu(btn : HTMLButtonElement) {\n        let openMnu = this.curMenu;\n\n        if (this.isOpen && btn === this.curButton) {\n            this.closeMenu();\n        }\n\n        if (!openMnu || openMnu.getAttribute('id') !== btn.getAttribute('menu')) {\n            this.openMenu(btn);\n        }\n    }\n\n\n    static focusMenu() {\n        if (!this.curMenu) {\n            return;\n        }\n\n        if (this.focusCount === null) {\n            this.focusCount = 0;\n        }\n\n        let length = this.curMenu.children.length;\n\n        if (this.focusCount < 0) {\n            this.focusCount += length;\n        }\n\n        let mi = this.curMenu.children[this.focusCount % length] as HTMLElement;\n        mi.focus();\n    }\n\n\n    private static clickMenuItem() {\n        if (!this.curMenu) {\n            return;\n        }\n\n        let length = this.curMenu.children.length;\n        let mi = this.curMenu.children[(this.focusCount || 0) % length] as HTMLElement;\n\n        if (!mi.hasAttribute('disabled')) {\n            mi.click();\n        }\n    }\n\n\n    private static addMenuStyle() {\n        if (!this.curMenu || !this.curButton) {\n            return;\n        }\n\n        let menu = this.curMenu!;\n        let btn = this.curButton!;\n\n        // Add the menu to the DOM for measuring\n        menu.style.display = 'block';\n        menu.style.position = 'fixed';\n        menu.setAttribute('role', 'menu');\n        menu.setAttribute('data-owner', 'button');\n\n        // Try to unset the type so Firefox can make it visible :'(\n        menu.setAttribute('type', '');\n\n        // Ensure the children are focusable\n        for (let i = 0; i < menu.children.length; i++) {\n            menu.children[i].setAttribute('tabindex', '-1');\n            menu.children[i].setAttribute('role', 'menuitem');\n\n            menu.children[i].setAttribute('aria-disabled', menu.children[i].hasAttribute('disabled').toString());\n        }\n\n        requestAnimationFrame(() => {\n            let btnSize = btn.getBoundingClientRect();\n            let menuSize = menu.getBoundingClientRect();\n            let wndHeight = window.innerHeight;\n\n            if (btnSize.bottom + menuSize.height > wndHeight) {\n                menu.style.bottom = btnSize.top + 'px';\n            } else {\n                menu.style.top = btnSize.bottom + 'px';\n            }\n\n            if (menuSize.width > btnSize.right) {\n                menu.style.left = btnSize.left + 'px';\n            } else {\n                menu.style.left = (btnSize.right - menuSize.width) + 'px';\n            }\n\n            if ('transform' in menu.style) {\n                menu.style.transform = 'scaleY(1)';\n            } else {\n                menu.style.webkitTransform = 'scaleY(1)';\n            }\n        });\n    }\n\n\n    private static clickListener(e : MouseEvent) {\n        if (!MenuManager.curButton || !MenuManager.curMenu) {\n            return;\n        }\n\n        if (MenuManager.curMenu.contains(e.target as Node)) {\n            return;\n        }\n\n        if (MenuManager.curButton.contains(e.target as Node)) {\n            return;\n        }\n\n        MenuManager.curButton.focus();\n        MenuManager.closeMenu();\n    }\n\n\n    private static menuClickListener(e : MouseEvent) {\n        if (!MenuManager.curButton || !MenuManager.curMenu) {\n            return;\n        }\n\n        let mi = e.target as HTMLElement;\n\n        if (!MenuManager.curMenu.contains(mi)) {\n            return;\n        }\n\n        if (mi.hasAttribute('disabled')) {\n            return;\n        }\n\n        MenuManager.curButton.focus();\n        MenuManager.closeMenu();\n    }\n\n\n    private static handleBlur(e : FocusEvent) {\n        if (!MenuManager.curButton) {\n            return;\n        }\n\n        // Element that focus is moving to\n        let activeEl = e.relatedTarget as HTMLElement | null;\n\n        if (!activeEl) {\n            return;\n        }\n\n        if (MenuManager.curButton === activeEl) {\n            return;\n        }\n\n        if (MenuManager.curMenu && MenuManager.curMenu.contains(activeEl)) {\n            return;\n        }\n\n        // Wait until after focus has moved before closing the menu\n        setTimeout(() => {\n            if (MenuManager.isOpen) {\n                MenuManager.closeMenu();\n            }\n        }, 0);\n    }\n\n\n    private static menuKeypressListener(e : KeyboardEvent) {\n        if (!MenuManager.isOpen) {\n            return;\n        }\n\n        // Escape\n        if (e.keyCode === 27) {\n            if (MenuManager.curButton) {\n                MenuManager.curButton.focus();\n            }\n\n            MenuManager.closeMenu();\n        }\n\n        // Up Arrow\n        if (e.keyCode === 38) {\n            e.preventDefault();\n            e.stopPropagation();\n\n            if (MenuManager.focusCount !== null) {\n                MenuManager.focusCount--;\n            }\n            MenuManager.focusMenu();\n        }\n\n        // Down Arrow\n        if (e.keyCode === 40) {\n            e.preventDefault();\n            e.stopPropagation();\n\n            if (MenuManager.focusCount !== null) {\n                MenuManager.focusCount++;\n            }\n            MenuManager.focusMenu();\n        }\n\n\n        // Enter and Spacebar\n        if (e.keyCode === 32 || e.keyCode === 13) {\n            e.preventDefault();\n            e.stopPropagation();\n\n            MenuManager.clickMenuItem();\n        }\n    }\n\n\n    private static getScrollOffset() {\n        let doc = this.curButton!.ownerDocument;\n\n        if (doc.body.style.top) {\n            return Math.abs(parseInt(doc.body.style.top, 10));\n        }\n\n        if (doc.scrollingElement) {\n            return doc.scrollingElement.scrollTop;\n        } else {\n            return doc.documentElement.scrollTop + doc.body.scrollTop;\n        }\n    }\n\n\n    private static blockScrolling(offset : number) {\n        let doc = this.curButton!.ownerDocument;\n        let htmlNode = doc.documentElement;\n        let clientWidth = doc.body.clientWidth;\n\n        if (doc.body.scrollHeight > htmlNode.clientHeight) {\n            doc.body.style.position = 'fixed';\n            doc.body.style.width = '100%';\n            doc.body.style.top = -offset + 'px';\n\n            htmlNode.style.overflowY = 'scroll';\n        }\n\n        if (doc.body.clientWidth < clientWidth) {\n            doc.body.style.overflow = 'hidden';\n        }\n\n        return function() {\n            doc.body.style.position = null;\n            doc.body.style.width = null;\n            doc.body.style.top = null;\n            doc.body.style.overflow = null;\n            htmlNode.style.overflowY = null;\n\n            if (doc.scrollingElement) {\n                doc.scrollingElement.scrollTop = offset;\n            } else {\n                scrollTo(0, offset);\n            }\n        };\n    }\n}\n","/*! Copyright 2016 Ayogo Health Inc. */\n\nimport { MenuManager } from './manager';\n\nexport class MenuButtonBehaviour {\n    private el: null | HTMLButtonElement;\n\n    private clickHandler : null | (() => void);\n    private keyHandler : null | ((e : KeyboardEvent) => void);\n    private resizeHandler : null | (() => void);\n\n    constructor(btn : HTMLButtonElement) {\n        this.el = btn;\n\n        this.el.setAttribute('aria-haspopup', 'true');\n        this.el.setAttribute('aria-expanded', 'false');\n\n        this.clickHandler = () => {\n            MenuManager.toggleMenu(this.el!);\n        };\n\n        this.keyHandler = (e : KeyboardEvent) => {\n            this.buttonKeypressListener(e);\n        };\n\n        this.resizeHandler = () => {\n            MenuManager.closeMenu();\n        };\n\n        this.el.addEventListener('click', this.clickHandler!);\n        this.el.addEventListener('keydown', this.keyHandler!);\n        window.addEventListener('resize', this.resizeHandler!);\n    }\n\n\n    // Cleanup function\n    destroy() {\n        if (this.el) {\n            this.el.removeEventListener('click', this.clickHandler!);\n            this.el.removeEventListener('keydown', this.keyHandler!);\n            window.removeEventListener('resize', this.resizeHandler!);\n        }\n\n        this.clickHandler = null;\n        this.keyHandler = null;\n        this.resizeHandler = null;\n        this.el = null;\n    }\n\n\n    private buttonKeypressListener(e : KeyboardEvent) {\n        // Escape\n        if (MenuManager.open && e.keyCode == 27) {\n            MenuManager.closeMenu();\n        }\n\n        // DOWN ARROW\n        if (e.keyCode == 40) {\n            if (!MenuManager.open) {\n                MenuManager.openMenu(this.el!, true);\n            } else {\n                MenuManager.focusMenu();\n            }\n        }\n    }\n}\n","/*! Copyright 2016 Ayogo Health Inc. */\n\n\nimport { MenuButtonBehaviour } from './button';\n\nconst MENU_STYLES = `\nmenu[type=\"context\"],\nmenu[data-owner=\"button\"] {\n    display: none;\n    padding: 0;\n    margin: 0;\n    border: 1px solid;\n    will-change: transform;\n    transform: scaleY(0);\n    transform-origin: top center;\n    transition: transform 225ms cubic-bezier(0.4, 0.0, 0.2, 1);\n}\n\nmenuitem {\n    display: list-item;\n    list-style-type: none;\n    background: Menu;\n    font: menu;\n    padding: 0.25em 0.5em;\n    cursor: default;\n}\n\nmenuitem::after {\n    content: attr(label);\n}\n\nmenuitem[disabled] {\n    color: GrayText;\n}\n\nmenuitem:not([disabled]):hover,\nmenuitem:not([disabled]):focus {\n    background: Highlight;\n    color: HighlightText;\n}\n\nbutton[type=\"menu\"]::after,\nbutton[data-type=\"menu\"]:after { content: ' â¾'; }\n\nbutton[type=\"menu\"]:empty::after,\nbutton[data-type=\"menu\"]:empty:after { content: 'â¾'; } /* No space character */\n`;\n\n\nconst PREFIX_STYLES = `\nmenu[type=\"context\"],\nmenu[data-owner=\"button\"] {\n    -webkit-transform: scaleY(0);\n    -webkit-transform-origin: top center;\n    -webkit-transition: -webkit-transform 225ms cubic-bezier(0.4, 0.0, 0.2, 1);\n    transition: -webkit-transform 225ms cubic-bezier(0.4, 0.0, 0.2, 1);\n}\n`\n\n\n// Inject default styling\n\nlet mnuStyle = document.createElement('style');\nmnuStyle.appendChild(document.createTextNode(MENU_STYLES));\n\n// Add old prefixed styles for older iOS and Android devices\nif (!('transform' in document.createElement('div').style)) {\n    mnuStyle.appendChild(document.createTextNode(PREFIX_STYLES));\n}\n\n\nlet insertPoint : HTMLElement | null;\nif (insertPoint = document.querySelector('link')) {\n    insertPoint.parentNode!.insertBefore(mnuStyle, insertPoint);\n} else\nif (insertPoint = document.querySelector('style')) {\n    insertPoint.parentNode!.insertBefore(mnuStyle, insertPoint);\n} else\nif (insertPoint = document.querySelector('head')) {\n    insertPoint.appendChild(mnuStyle);\n} else {\n    document.appendChild(mnuStyle);\n}\n\n\nlet gcCache : WeakMap<HTMLButtonElement, MenuButtonBehaviour> | null = null;\nif ('WeakMap' in window) {\n    gcCache = new WeakMap();\n}\n\n\nexport default function MenuButton(el : HTMLButtonElement) {\n    let behaviour = new MenuButtonBehaviour(el);\n\n    if (gcCache) {\n        gcCache.set(el, behaviour);\n    }\n\n    return behaviour;\n}\n","/*! Copyright 2016 Ayogo Health Inc. */\n\nimport * as angular from 'angular';\nimport MenuButton from './index';\n\nconst modName = 'ayMenuButton';\n\nangular.module(modName, [])\n.directive('button', function() {\n    return {\n        restrict: 'E',\n        link: function(_$scope, $element) {\n            let el = $element[0] as HTMLButtonElement;\n\n            if (el.getAttribute('type') === 'menu' || el.getAttribute('data-type') === 'menu') {\n                let behaviour = MenuButton(el);\n\n                $element.on('$destroy', () => {\n                    behaviour.destroy();\n                });\n            }\n        }\n    };\n});\n\nexport default modName;\n"],"names":["angular.module"],"mappings":"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"}