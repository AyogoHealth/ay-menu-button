/*! Copyright 2016 Ayogo Health Inc. */
import { MenuManager } from './manager';
export class MenuButtonBehaviour {
    constructor(btn) {
        this.el = btn;
        let menuID = this.el.getAttribute('menu');
        if (!menuID) {
            return;
        }
        let menu = btn.ownerDocument.getElementById(menuID);
        if (!menu) {
            return;
        }
        this.menu = menu;
        this.el.setAttribute('aria-haspopup', 'true');
        this.el.setAttribute('aria-expanded', 'false');
        this.clickHandler = () => {
            MenuManager.toggleMenu(this.el, this.menu);
        };
        this.keyHandler = (e) => {
            this.buttonKeypressListener(e);
        };
        this.el.addEventListener('click', this.clickHandler);
        this.el.addEventListener('keydown', this.keyHandler);
    }
    destroy() {
        if (this.el) {
            this.el.removeEventListener('click', this.clickHandler);
            this.el.removeEventListener('keydown', this.keyHandler);
        }
        this.clickHandler = null;
        this.keyHandler = null;
        this.menu = null;
        this.el = null;
    }
    buttonKeypressListener(e) {
        if (MenuManager.open && e.keyCode == 27) {
            MenuManager.closeMenu();
        }
        if (e.keyCode == 40) {
            if (!MenuManager.open) {
                MenuManager.openMenu(this.el, this.menu, true);
            }
            else {
                MenuManager.focusMenu();
            }
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnV0dG9uLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL2J1dHRvbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSx1Q0FBdUM7QUFFdkMsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUV4QyxNQUFNO0lBT0YsWUFBWSxHQUF1QjtRQUMvQixJQUFJLENBQUMsRUFBRSxHQUFHLEdBQUcsQ0FBQztRQUVkLElBQUksTUFBTSxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUMsWUFBWSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQzFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztZQUNWLE1BQU0sQ0FBQztRQUNYLENBQUM7UUFFRCxJQUFJLElBQUksR0FBRyxHQUFHLENBQUMsYUFBYSxDQUFDLGNBQWMsQ0FBQyxNQUFNLENBQW9CLENBQUM7UUFDdkUsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1lBQ1IsTUFBTSxDQUFDO1FBQ1gsQ0FBQztRQUVELElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO1FBRWpCLElBQUksQ0FBQyxFQUFFLENBQUMsWUFBWSxDQUFDLGVBQWUsRUFBRSxNQUFNLENBQUMsQ0FBQztRQUM5QyxJQUFJLENBQUMsRUFBRSxDQUFDLFlBQVksQ0FBQyxlQUFlLEVBQUUsT0FBTyxDQUFDLENBQUM7UUFFL0MsSUFBSSxDQUFDLFlBQVksR0FBRztZQUNoQixXQUFXLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxFQUFHLEVBQUUsSUFBSSxDQUFDLElBQUssQ0FBQyxDQUFDO1FBQ2pELENBQUMsQ0FBQztRQUVGLElBQUksQ0FBQyxVQUFVLEdBQUcsQ0FBQyxDQUFpQjtZQUNoQyxJQUFJLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDbkMsQ0FBQyxDQUFDO1FBRUYsSUFBSSxDQUFDLEVBQUUsQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLFlBQWEsQ0FBQyxDQUFDO1FBQ3RELElBQUksQ0FBQyxFQUFFLENBQUMsZ0JBQWdCLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQyxVQUFXLENBQUMsQ0FBQztJQUMxRCxDQUFDO0lBSUQsT0FBTztRQUNILEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQ1YsSUFBSSxDQUFDLEVBQUUsQ0FBQyxtQkFBbUIsQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLFlBQWEsQ0FBQyxDQUFDO1lBQ3pELElBQUksQ0FBQyxFQUFFLENBQUMsbUJBQW1CLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQyxVQUFXLENBQUMsQ0FBQztRQUM3RCxDQUFDO1FBRUQsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUM7UUFDekIsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUM7UUFDdkIsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7UUFDakIsSUFBSSxDQUFDLEVBQUUsR0FBRyxJQUFJLENBQUM7SUFDbkIsQ0FBQztJQUdPLHNCQUFzQixDQUFDLENBQWlCO1FBRTVDLEVBQUUsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxJQUFJLElBQUksQ0FBQyxDQUFDLE9BQU8sSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQ3RDLFdBQVcsQ0FBQyxTQUFTLEVBQUUsQ0FBQztRQUM1QixDQUFDO1FBR0QsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQ2xCLEVBQUUsQ0FBQyxDQUFDLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7Z0JBQ3BCLFdBQVcsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEVBQUcsRUFBRSxJQUFJLENBQUMsSUFBSyxFQUFFLElBQUksQ0FBQyxDQUFDO1lBQ3JELENBQUM7WUFBQyxJQUFJLENBQUMsQ0FBQztnQkFDSixXQUFXLENBQUMsU0FBUyxFQUFFLENBQUM7WUFDNUIsQ0FBQztRQUNMLENBQUM7SUFDTCxDQUFDO0NBQ0oiLCJzb3VyY2VzQ29udGVudCI6WyIvKiEgQ29weXJpZ2h0IDIwMTYgQXlvZ28gSGVhbHRoIEluYy4gKi9cblxuaW1wb3J0IHsgTWVudU1hbmFnZXIgfSBmcm9tICcuL21hbmFnZXInO1xuXG5leHBvcnQgY2xhc3MgTWVudUJ1dHRvbkJlaGF2aW91ciB7XG4gICAgcHJpdmF0ZSBlbDogbnVsbCB8IEhUTUxCdXR0b25FbGVtZW50O1xuICAgIHByaXZhdGUgbWVudSA6IG51bGwgfCBIVE1MTWVudUVsZW1lbnQ7XG5cbiAgICBwcml2YXRlIGNsaWNrSGFuZGxlciA6IG51bGwgfCAoKCkgPT4gdm9pZCk7XG4gICAgcHJpdmF0ZSBrZXlIYW5kbGVyIDogbnVsbCB8ICgoZSA6IEtleWJvYXJkRXZlbnQpID0+IHZvaWQpO1xuXG4gICAgY29uc3RydWN0b3IoYnRuIDogSFRNTEJ1dHRvbkVsZW1lbnQpIHtcbiAgICAgICAgdGhpcy5lbCA9IGJ0bjtcblxuICAgICAgICBsZXQgbWVudUlEID0gdGhpcy5lbC5nZXRBdHRyaWJ1dGUoJ21lbnUnKTtcbiAgICAgICAgaWYgKCFtZW51SUQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBtZW51ID0gYnRuLm93bmVyRG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobWVudUlEKSBhcyBIVE1MTWVudUVsZW1lbnQ7XG4gICAgICAgIGlmICghbWVudSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5tZW51ID0gbWVudTtcblxuICAgICAgICB0aGlzLmVsLnNldEF0dHJpYnV0ZSgnYXJpYS1oYXNwb3B1cCcsICd0cnVlJyk7XG4gICAgICAgIHRoaXMuZWwuc2V0QXR0cmlidXRlKCdhcmlhLWV4cGFuZGVkJywgJ2ZhbHNlJyk7XG5cbiAgICAgICAgdGhpcy5jbGlja0hhbmRsZXIgPSAoKSA9PiB7XG4gICAgICAgICAgICBNZW51TWFuYWdlci50b2dnbGVNZW51KHRoaXMuZWwhLCB0aGlzLm1lbnUhKTtcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLmtleUhhbmRsZXIgPSAoZSA6IEtleWJvYXJkRXZlbnQpID0+IHtcbiAgICAgICAgICAgIHRoaXMuYnV0dG9uS2V5cHJlc3NMaXN0ZW5lcihlKTtcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLmVsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5jbGlja0hhbmRsZXIhKTtcbiAgICAgICAgdGhpcy5lbC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgdGhpcy5rZXlIYW5kbGVyISk7XG4gICAgfVxuXG5cbiAgICAvLyBDbGVhbnVwIGZ1bmN0aW9uXG4gICAgZGVzdHJveSgpIHtcbiAgICAgICAgaWYgKHRoaXMuZWwpIHtcbiAgICAgICAgICAgIHRoaXMuZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLmNsaWNrSGFuZGxlciEpO1xuICAgICAgICAgICAgdGhpcy5lbC5yZW1vdmVFdmVudExpc3RlbmVyKCdrZXlkb3duJywgdGhpcy5rZXlIYW5kbGVyISk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmNsaWNrSGFuZGxlciA9IG51bGw7XG4gICAgICAgIHRoaXMua2V5SGFuZGxlciA9IG51bGw7XG4gICAgICAgIHRoaXMubWVudSA9IG51bGw7XG4gICAgICAgIHRoaXMuZWwgPSBudWxsO1xuICAgIH1cblxuXG4gICAgcHJpdmF0ZSBidXR0b25LZXlwcmVzc0xpc3RlbmVyKGUgOiBLZXlib2FyZEV2ZW50KSB7XG4gICAgICAgIC8vIEVzY2FwZVxuICAgICAgICBpZiAoTWVudU1hbmFnZXIub3BlbiAmJiBlLmtleUNvZGUgPT0gMjcpIHtcbiAgICAgICAgICAgIE1lbnVNYW5hZ2VyLmNsb3NlTWVudSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gRE9XTiBBUlJPV1xuICAgICAgICBpZiAoZS5rZXlDb2RlID09IDQwKSB7XG4gICAgICAgICAgICBpZiAoIU1lbnVNYW5hZ2VyLm9wZW4pIHtcbiAgICAgICAgICAgICAgICBNZW51TWFuYWdlci5vcGVuTWVudSh0aGlzLmVsISwgdGhpcy5tZW51ISwgdHJ1ZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIE1lbnVNYW5hZ2VyLmZvY3VzTWVudSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufVxuIl19